<!doctype html>
<html lang="vi">
<head><meta charset="utf-8"><title>Thanh toán</title><meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"></head>
<body>
<div class="container py-4">
  <h3>Checkout</h3>
  <form id="co">
    <div class="mb-3"><input id="addr" class="form-control" placeholder="Địa chỉ giao hàng" required></div>
    <div class="mb-3">
      <select id="pay" class="form-select"><option value="cod">Tiền mặt khi nhận</option><option value="bank">Chuyển khoản</option><option value="online">Thanh toán trực tuyến</option></select>
    </div>
    <button class="btn btn-primary">Hoàn tất đặt hàng</button>
  </form>
</div>
<script>
document.getElementById('co').addEventListener('submit', function(e){
  e.preventDefault();
  const session = JSON.parse(localStorage.getItem('session')||'null');
  if(!session) { alert('Bạn phải đăng nhập để đặt hàng'); location.href='login.html'; return; }
  const cart = JSON.parse(localStorage.getItem('cart')||'[]');
  if(cart.length===0) { alert('Giỏ hàng trống'); location.href='product_list.html'; return; }
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  const code = 'DH'+Date.now();
  orders.push({code, date: new Date().toISOString().slice(0,10), customer: session.name, items: cart, status:'mới đặt', address: document.getElementById('addr').value, payment: document.getElementById('pay').value});
  localStorage.setItem('orders', JSON.stringify(orders));
  localStorage.removeItem('cart');
  alert('Đặt hàng thành công: '+code);
  location.href='order_history.html';
});
</script>
</body>
</html>
